#! /usr/bin/perl -wX


use CGI;
use DBI;
$q = new CGI;

$ENV{'SHELL'} = '/bin/sh';		
$ENV{'PATH'} = '/usr/lib/jvm/java-1.5.0-sun-1.5.0.10/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/X11R6/bin';

require "/opt/imt/web/modulos/rutaidioma";
require "/opt/imt/web/modulos/rutaficheros";
$aux = "/tmp/aux".int(rand(10000));


open(OLD, "< $modulos")    or die "can't open $modulos: $!";
		
	while (<OLD>) 
	{			
			if (/^\s*UNIDAD\s*=.*$/)
	        {
                chomp;
                $_ =~ s/^\s+//;
                @data = split (/\s*=\s*/,$_);
                $unidad = $data[1];
    	    }
	}
close(OLD);

if (-e "/proc/ide/${dispo}/identify")
{
$numserietest2=`/bin/cat /proc/ide/${dispo}/identify | /usr/bin/perl -e \'<>;(\$tmp = substr(<>,10,29)\.substr(<>,0,20) ) =~ s/\\ //g;print chr(hex \$_) foreach (unpack("a2" x 20,\$tmp))\'`;
$numserietest2 =~ s/\s*//g;
}
else
{
   $pasocontrol=1;
}

if($pasocontrol eq 1)
{
        for($i = 0; $i < 9; $i++) {

                $usbid = "/proc/scsi/usb-storage/$i";

                if (-e "$usbid")
                {

                open(OLD, "< $usbid")    or die "can't open $usbid: $!";
                while (<OLD>)
                {
                        if (/^\s*Serial\sNumber\s*:.*$/)
                        {
                        chomp;
                        $_ =~ s/^\s+//;
                        @data = split (/\s*:\s*/,$_);

                        $numserietest2 = $data[1];
                                        if ($codigounidad =~ /$numserietest2/)
                                        {
                                                last;
                                        }
						$numserietest2="";				
                        }
                }
                close(OLD);

                }

        }
}

if($numserietest2 eq "" || $numserietest2 eq "None"){$pasocontrol=2}

if($pasocontrol eq 2)
{
        $infoidcf=`/sbin/hdparm -I /dev/$dispo`;

        if ($infoidcf =~ /Serial\sNumber\s*:(.+)/m)
        {
                $numserietest2 = $1;
                $numserietest2 =~ s/\s+//g;
        }
}

if($codigounidad !~ /$numserietest2/){exit;}



$infotest=`/opt/imt/gestor/tools/networking/ptelnet.pl 127.0.0.1 3306`;
$testmysqlping=`/usr/bin/mysqladmin ping | grep alive`;

$tipologinfile=0;

if($infotest =~ /no conecta/ || $testmysqlping eq "")
{
$tipologinfile=1;
}

my $dbh;
my $sth;

if($tipologinfile eq 0)
{

$dbuser="root";
$dbpass="";


    $dbh = DBI->connect('DBI:mysql:database=controlweb;host=localhost;port=3306',$dbuser,$dbpass)
               	 or die "Couldn't connect to database: " . DBI->errstr;

}				 
				 
				 
if($q->param('env') eq "quitarguia")
{
	system("/bin/echo '0' > $sinoguia");
}


if($q->param('env') eq "webreg")
{
	$sth = $dbh->prepare("DELETE from pasoreg")
                	or die "Couldn't prepare statement: " . $dbh->errstr;

	$sth->execute()  or die "Couldn't execute statement: " . $sth->errstr;
}


if($q->param('env') eq "sshreg")
{
	$sth = $dbh->prepare("DELETE from sshreg")
                	or die "Couldn't prepare statement: " . $dbh->errstr;

	$sth->execute()  or die "Couldn't execute statement: " . $sth->errstr;
}


$numnotas=0;

#lectura inicial de los servicios
#иииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии	

	open(OLD, "< $listanotas")    or die "can't open $listanotas: $!";
		
	while (<OLD>) 
	{
			unless (/^#/)
     		{
				$numnotas=$numnotas+1;
			}
	}

	close(OLD)     or die "can't close $listanotas: $!";



if($q->param('env') eq "nombreid")
{

			$nombreid=$q->param('nombreid');
			
			open(OLD, "< $modulos")    or die "can't open $modulos: $!";
			open(NEW, "> $aux")     or die "can't open $aux: $!";
		
			while (<OLD>) 
			{
				if (/^\s*NOMBREID\s*=.*$/)
				{  
					s/^.*$/NOMBREID=${nombreid}/; 
				} 
			print NEW $_            or die "can't write $aux: $!"; 	
			}

			close(OLD)     or die "can't close $variables: $!";
			close(NEW)     or die "can't close $aux: $!";
			system("/bin/cp $aux $modulos  >/dev/null 2>&1");
			
			
			
			
		open(OLD, "< $smbconf")    or die "can't open $smbconf: $!";
		open(NEW, "> $aux")     or die "can't open $aux: $!";
		
		while (<OLD>) 
		{
		
			if (/^\s*netbios\sname\s*=.*$/)
     		{
				s/^.*$/	netbios name = ${nombreid}/;
			}
		
             print NEW $_            or die "can't write $aux: $!";
		}

		close(OLD)                  or die "can't close $smbconf: $!";
		close(NEW)                  or die "can't close $aux: $!";

		system("/bin/cp $aux $smbconf 1>&2");
			
		system("$samba restart >/dev/null 2>&1");	
			
			
}


if($q->param('env') eq "aplicarinfo")
{

			$infonombre=$q->param('infonombre');
			$infolocalidad=$q->param('infolocalidad');
			$infopais=$q->param('infopais');
			$infocomentario=$q->param('infocomentario');
			
			$infocomentario =~ s/\n//g;
			
			open(OLD, "< $home")    or die "can't open $home: $!";
			open(NEW, "> $aux")     or die "can't open $aux: $!";
		
			while (<OLD>) 
			{
				if (/^\s*INFONOMBRE\s*=.*$/)
				{  
					s/^.*$/INFONOMBRE=\"${infonombre}\"/; 
				} 
				
				if (/^\s*INFOLOCALIDAD\s*=.*$/)
				{  
					s/^.*$/INFOLOCALIDAD=\"${infolocalidad}\"/; 
				} 
				
				if (/^\s*INFOPAIS\s*=.*$/)
				{  
					s/^.*$/INFOPAIS=\"${infopais}\"/; 
				} 
				
				if (/^\s*INFOCOMENTARIO\s*=.*$/)
				{  
					s/^.*$/INFOCOMENTARIO=\"${infocomentario}\"/; 
				} 
				
			print NEW $_            or die "can't write $aux: $!"; 	
			}

			system("/usr/bin/wget -bq \"http://maps.google.es/maps?q=calle ${infolocalidad}&output=html&zoom=2\" -O $enlacegoogle -o /tmp/wget-log >/dev/null 2>&1");
			
			close(OLD)     or die "can't close $home: $!";
			close(NEW)     or die "can't close $aux: $!";
			system("/bin/cp $aux $home  >/dev/null 2>&1");
						
			
}


#lectura inicial de conf de servidor web
#иииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии	

	open(OLD, "< $portsconf")    or die "can't open $portsconf: $!";
	
	$p=0;
		
	while (<OLD>) 
	{
			if (/^Listen\s.*/)
     		{
				chomp;
				$_ =~ s/^\s+//;
				@data = split (/\s/,$_);
				if($p eq 0)
				{
		 		$puerto = $data[1];
				$p=1;
				}
			}
	
	}

	close(OLD)     or die "can't close $portsconf: $!";




#home
#иииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии	

	open(OLD, "< $home")    or die "can't open $home: $!";
		
	while (<OLD>) 
	{
			if (/^\s*IDIOMA\s*=.*$/)
     		{
				chomp;
				$_ =~ s/^\s+//;
				@data = split (/\s*=\s*/,$_);
		 		$idioma = $data[1];
			}
			
			if (/^\s*DISTRIBUIDOR\s*=.*$/)
     		{
				chomp;
				$_ =~ s/^\s+//;
				@data = split (/\s*=\s*/,$_);
		 		$distribuidor = $data[1];
				$distribuidor =~ s/"//g;
			}
			
			if (/^\s*INFONOMBRE\s*=.*$/)
     		{
				chomp;
				$_ =~ s/^\s+//;
				@data = split (/\s*=\s*/,$_);
		 		$infonombre = $data[1];
				$infonombre =~ s/"//g;
			}
			
			if (/^\s*INFOLOCALIDAD\s*=.*$/)
     		{
				chomp;
				$_ =~ s/^\s+//;
				@data = split (/\s*=\s*/,$_);
		 		$infolocalidad = $data[1];
				$infolocalidad =~ s/"//g;
			}
			
			if (/^\s*INFOPAIS\s*=.*$/)
     		{
				chomp;
				$_ =~ s/^\s+//;
				@data = split (/\s*=\s*/,$_);
		 		$infopais = $data[1];
				$infopais =~ s/"//g;
			}
			
			if (/^\s*INFOCOMENTARIO\s*=.*$/)
     		{
				chomp;
				$_ =~ s/^\s+//;
				@data = split (/\s*=\s*/,$_);
		 		$infocomentario = $data[1];
				$infocomentario =~ s/"//g;
			}
		
	}

	close(OLD)     or die "can't close $home: $!";


if($sesiidioma eq "ingles") {$idiomaimagen = "bandera_ingles_mini"}
if($sesiidioma eq "aleman") {$idiomaimagen = "bandera_aleman_mini"}
if($sesiidioma eq "frances") {$idiomaimagen = "bandera_frances_mini"}
if($sesiidioma eq "espanol") {$idiomaimagen = "bandera_espanol_mini"}
if($sesiidioma eq "italiano") {$idiomaimagen = "bandera_italiano_mini"}
if($sesiidioma eq "chino") {$idiomaimagen = "bandera_chino_mini"}
if($sesiidioma eq "japones") {$idiomaimagen = "bandera_japones_mini"}
if($sesiidioma eq "euskera") {$idiomaimagen = "bandera_euskera_mini"}
if($sesiidioma eq "catalan") {$idiomaimagen = "bandera_catalan_mini"}
if($sesiidioma eq "gallego") {$idiomaimagen = "bandera_gallego_mini"}
if($sesiidioma eq "portugues") {$idiomaimagen = "bandera_portugues_mini"}
if($sesiidioma eq "polaco") {$idiomaimagen = "bandera_polaco_mini"}
if($sesiidioma eq "ruso") {$idiomaimagen = "bandera_ruso_mini"}
if($sesiidioma eq "personalizado") {$idiomaimagen = "bandera_personalizado_mini"}




#modulos
#иииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии	

	open(OLD, "< $modulos")    or die "can't open $modulos: $!";
		
	while (<OLD>) 
	{
			if (/^\s*VRS\s*=.*$/)
     		{
				chomp;
				$_ =~ s/^\s+//;
				@data = split (/\s*=\s*/,$_);
		 		$version = $data[1];
			}
			
			if (/^\s*DESPLIEGUE\s*=.*$/)
     		{
				chomp;
				$_ =~ s/^\s+//;
				@data = split (/\s*=\s*/,$_);
		 		$tipodespliegue = $data[1];

				#Mostrar el tipo de despliegue
				#иииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии

				if($tipodespliegue eq "1") 
				{
					$despliegue = "APPLIANCE";
				}

				if($tipodespliegue eq "2") 
				{
					$despliegue = "PASARELA";
				}
			}

			if (/^\s*CODDISTRI\s*=.*$/)
     		{
				chomp;
				$_ =~ s/^\s+//;
				@data = split (/\s*=\s*/,$_);
		 		$coddistri = $data[1];
			}

			if (/^\s*GARANTIA_SERVICIO\s*=.*$/)
     		{
				chomp;
				$_ =~ s/^\s+//;
				@data = split (/\s*=\s*/,$_);
		 		$garantia_servicio = $data[1];
				
				if($garantia_servicio eq "00-00-00")
				{
					$garantia_servicio="ILIMITADO";
				}
				
			}

			if (/^\s*GARANTIA_HARDWARE\s*=.*$/)
     		{
				chomp;
				$_ =~ s/^\s+//;
				@data = split (/\s*=\s*/,$_);
		 		$garantia_hardware = $data[1];
			}
			
			if (/^\s*NUM_SERIE\s*=.*$/)
     		{
				chomp;
				$_ =~ s/^\s+//;
				@data = split (/\s*=\s*/,$_);
		 		$num_serie = $data[1];
			}
			
			if (/^\s*NOMBREID\s*=.*$/)
     		{
				chomp;
				$_ =~ s/^\s+//;
				@data = split (/\s*=\s*/,$_);
		 		$nombreid = $data[1];
			}
		
	}

	close(OLD)     or die "can't close $modulos: $!";



#lectura licencia antivirus
#иииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии	

	open(OLD, "< $license")    or die "can't open $license: $!";
		
	while (<OLD>) 
	{
			if (/^ANTIVIRUS/)
     		{
				chomp;
				$_ =~ s/^\s+//;
				@data = split (/=/,$_);
		 		$antivirus = $data[1];
			}
			
			if (/^AVDATE_FIN/)
     		{
				chomp;
				$_ =~ s/^\s+//;
				@data = split (/=/,$_);
		 		$avdatefin = $data[1];
			}
	
	}

	close(OLD)     or die "can't close $license: $!";



#lectura inicial de variables
#иииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии	

	open(OLD, "< $variables")    or die "can't open $variables: $!";
		
	while (<OLD>) 
	{

			if (/^\s*IP1\s*=.*$/)
     		{
				chomp;
				$_ =~ s/^\s+//;
				@data = split (/\s*=\s*/,$_);
		 		$ip1 = $data[1];
			}
			elsif(/^\s*BRIDGEIP\s*=.*$/)
     		{
				chomp;
				$_ =~ s/^\s+//;
				@data = split (/\s*=\s*/,$_);
		 		$ip1 = $data[1];
			}
	}

	close(OLD)     or die "can't close $variables: $!";


($wkday,$month,$day,$time,$year) = split(/\s+/, localtime);
$fecha="$day-$month-$year\n";

$hora="$time\n";

$uptime=`/usr/bin/uptime`;
$uptime =~ s/(\r?\n)/\<br\>/g;

@data = split (/,.*user/,$uptime);
@data2 = split (/up\s*/,$data[0]);
$uptimevalor = $data2[1];

@data = split (/\s*,\s*/,$uptime);
@data2 = split (/\s+/,$data[0]);

if($data[1]=~/user/)
{
$k=0;
}
else
{
$k=1;
}

$user = $data[1+$k];
$carga = $data[2+$k];


$memoria=`/usr/bin/free -m`;
@data = split (/\s+/,$memoria);

$totalmemoria=$data[8];
$usadamemoria=$data[16];
$librememoria=$data[17];

$cpuinfo=`/bin/cat /proc/cpuinfo`;
@data = split (/:\s*/,$cpuinfo);

@data2 = split (/\n/,$data[5]);
$modeloplaca=$data2[0];

@data2 = split (/\n/,$data[7]);
$cpumhz="cpu MHz ".$data2[0];

$porcenmemoriausada=int(($usadamemoria*100) / $totalmemoria);
#$porcenmemoriausada=100-$porcenmemorialibre;


$dispo=`/sbin/fdisk -l | grep '*'`;

@data = split (/\/dev\//,$dispo);
$dispo = $data[1];
@data = split (/[0-9]+\s+\*/,$dispo);
$dispo = $data[0];


if (-e "/proc/ide/${dispo}/identify")
{
$modelodis1=`/bin/cat /proc/ide/${dispo}/model`;
$modelodis=$modelodis1;

$modelonumserie=`/bin/cat /proc/ide/${dispo}/identify | /usr/bin/perl -e \'<>;(\$tmp = substr(<>,10,29)\.substr(<>,0,20) ) =~ s/\\ //g;print chr(hex \$_) foreach (unpack("a2" x 20,\$tmp))\'`;
$modelonumserie =~ s/KINGSTON CF//g; 
}
else
{
	    $infoidcf=`/sbin/hdparm -I /dev/$dispo`;

		if ($infoidcf =~ /Model\sNumber\s*:\s+(.+)\s+/m)
        {
                $modelodis = $1;
        }

        if ($infoidcf =~ /Serial\sNumber\s*:\s+(.+)\s+/m)
        {
                $modelonumserie = $1;
        }
}


$infokernel=`/bin/uname -rsm`;


#$ipcountry=`lynx -accept_all_cookies -dump  http://www.ip-adress.com | grep "IP address country"`;
#$ipcountry =~ s/flag\s//g;
#@data = split (/:/,$ipcountry);
#$ipcountry = $data[1];

#$ipaddress=`lynx -accept_all_cookies -dump  http://www.ip-adress.com | grep "IP address state"`;
#@data = split (/:/,$ipaddress);
#$ipaddress = $data[1];



				 
				 


if($infopais eq "AF"){$checkedAF="selected";}
elsif($infopais eq "AL"){$checkedAL="selected";}
elsif($infopais eq "DE"){$checkedDE="selected";}
elsif($infopais eq "AD"){$checkedAD="selected";}
elsif($infopais eq "AO"){$checkedAO="selected";}
elsif($infopais eq "AI"){$checkedAI="selected";}
elsif($infopais eq "AQ"){$checkedAQ="selected";}
elsif($infopais eq "DE"){$checkedDE="selected";}
elsif($infopais eq "AG"){$checkedAG="selected";}
elsif($infopais eq "AN"){$checkedAN="selected";}
elsif($infopais eq "SA"){$checkedSA="selected";}
elsif($infopais eq "DZ"){$checkedDZ="selected";}
elsif($infopais eq "AR"){$checkedAR="selected";}
elsif($infopais eq "AM"){$checkedAM="selected";}
elsif($infopais eq "AW"){$checkedAW="selected";}
elsif($infopais eq "AU"){$checkedAU="selected";}
elsif($infopais eq "AT"){$checkedAT="selected";}
elsif($infopais eq "AZ"){$checkedAZ="selected";}
elsif($infopais eq "BS"){$checkedBS="selected";}
elsif($infopais eq "BH"){$checkedBH="selected";}
elsif($infopais eq "BD"){$checkedBD="selected";}
elsif($infopais eq "BB"){$checkedBB="selected";}
elsif($infopais eq "BE"){$checkedBE="selected";}
elsif($infopais eq "BZ"){$checkedBZ="selected";}
elsif($infopais eq "BJ"){$checkedBJ="selected";}
elsif($infopais eq "BM"){$checkedBM="selected";}
elsif($infopais eq "BY"){$checkedBY="selected";}
elsif($infopais eq "BO"){$checkedBO="selected";}
elsif($infopais eq "BA"){$checkedBA="selected";}
elsif($infopais eq "BW"){$checkedBW="selected";}
elsif($infopais eq "BR"){$checkedBR="selected";}
elsif($infopais eq "BN"){$checkedBN="selected";}
elsif($infopais eq "BG"){$checkedBG="selected";}
elsif($infopais eq "BF"){$checkedBF="selected";}
elsif($infopais eq "BI"){$checkedBI="selected";}
elsif($infopais eq "BT"){$checkedBT="selected";}
elsif($infopais eq "CV"){$checkedCV="selected";}
elsif($infopais eq "KH"){$checkedKH="selected";}
elsif($infopais eq "CM"){$checkedCM="selected";}
elsif($infopais eq "CA"){$checkedCA="selected";}
elsif($infopais eq "TD"){$checkedTD="selected";}
elsif($infopais eq "CL"){$checkedCL="selected";}
elsif($infopais eq "CN"){$checkedCN="selected";}
elsif($infopais eq "CY"){$checkedCY="selected";}
elsif($infopais eq "VA"){$checkedVA="selected";}
elsif($infopais eq "CO"){$checkedCO="selected";}
elsif($infopais eq "KM"){$checkedKM="selected";}
elsif($infopais eq "CG"){$checkedCG="selected";}
elsif($infopais eq "KP"){$checkedKP="selected";}
elsif($infopais eq "KR"){$checkedKR="selected";}
elsif($infopais eq "CI"){$checkedCI="selected";}
elsif($infopais eq "CR"){$checkedCR="selected";}
elsif($infopais eq "HR"){$checkedHR="selected";}
elsif($infopais eq "CU"){$checkedCU="selected";}
elsif($infopais eq "DK"){$checkedDK="selected";}
elsif($infopais eq "DM"){$checkedDM="selected";}
elsif($infopais eq "EC"){$checkedEC="selected";}
elsif($infopais eq "EG"){$checkedEG="selected";}
elsif($infopais eq "SV"){$checkedSV="selected";}
elsif($infopais eq "AE"){$checkedAE="selected";}
elsif($infopais eq "ER"){$checkedER="selected";}
elsif($infopais eq "SK"){$checkedSK="selected";}
elsif($infopais eq "SI"){$checkedSI="selected";}
elsif($infopais eq "ES"){$checkedES="selected";}
elsif($infopais eq "US"){$checkedUS="selected";}
elsif($infopais eq "EE"){$checkedEE="selected";}
elsif($infopais eq "ET"){$checkedET="selected";}
elsif($infopais eq "PH"){$checkedPH="selected";}
elsif($infopais eq "FI"){$checkedFI="selected";}
elsif($infopais eq "FJ"){$checkedFJ="selected";}
elsif($infopais eq "FR"){$checkedFR="selected";}
elsif($infopais eq "GA"){$checkedGA="selected";}
elsif($infopais eq "GM"){$checkedGM="selected";}
elsif($infopais eq "GE"){$checkedGE="selected";}
elsif($infopais eq "GH"){$checkedGH="selected";}
elsif($infopais eq "GI"){$checkedGI="selected";}
elsif($infopais eq "GD"){$checkedGD="selected";}
elsif($infopais eq "GR"){$checkedGR="selected";}
elsif($infopais eq "GL"){$checkedGL="selected";}
elsif($infopais eq "GP"){$checkedGP="selected";}
elsif($infopais eq "GU"){$checkedGU="selected";}
elsif($infopais eq "GT"){$checkedGT="selected";}
elsif($infopais eq "GF"){$checkedGF="selected";}
elsif($infopais eq "GG"){$checkedGG="selected";}
elsif($infopais eq "GN"){$checkedGN="selected";}
elsif($infopais eq "GW"){$checkedGW="selected";}
elsif($infopais eq "GQ"){$checkedGQ="selected";}
elsif($infopais eq "GY"){$checkedGY="selected";}
elsif($infopais eq "HT"){$checkedHT="selected";}
elsif($infopais eq "HN"){$checkedHN="selected";}
elsif($infopais eq "HK"){$checkedHK="selected";}
elsif($infopais eq "HU"){$checkedHU="selected";}
elsif($infopais eq "IN"){$checkedIN="selected";}
elsif($infopais eq "ID"){$checkedID="selected";}
elsif($infopais eq "IR"){$checkedIR="selected";}
elsif($infopais eq "IQ"){$checkedIQ="selected";}
elsif($infopais eq "IE"){$checkedIE="selected";}
elsif($infopais eq "BV"){$checkedBV="selected";}
elsif($infopais eq "CX"){$checkedCX="selected";}
elsif($infopais eq "IM"){$checkedIM="selected";}
elsif($infopais eq "IS"){$checkedIS="selected";}
elsif($infopais eq "NF"){$checkedNF="selected";}
elsif($infopais eq "IL"){$checkedIL="selected";}
elsif($infopais eq "IT"){$checkedIT="selected";}
elsif($infopais eq "JM"){$checkedJM="selected";}
elsif($infopais eq "JP"){$checkedJP="selected";}
elsif($infopais eq "JE"){$checkedJE="selected";}
elsif($infopais eq "JO"){$checkedJO="selected";}
elsif($infopais eq "KZ"){$checkedKZ="selected";}
elsif($infopais eq "KE"){$checkedKE="selected";}
elsif($infopais eq "KG"){$checkedKG="selected";}
elsif($infopais eq "KI"){$checkedKI="selected";}
elsif($infopais eq "KW"){$checkedKW="selected";}
elsif($infopais eq "LA"){$checkedLA="selected";}
elsif($infopais eq "LS"){$checkedLS="selected";}
elsif($infopais eq "LV"){$checkedLV="selected";}
elsif($infopais eq "LB"){$checkedLB="selected";}
elsif($infopais eq "LR"){$checkedLR="selected";}
elsif($infopais eq "LY"){$checkedLY="selected";}
elsif($infopais eq "LI"){$checkedLI="selected";}
elsif($infopais eq "LT"){$checkedLT="selected";}
elsif($infopais eq "LU"){$checkedLU="selected";}
elsif($infopais eq "MO"){$checkedMO="selected";}
elsif($infopais eq "MK"){$checkedMK="selected";}
elsif($infopais eq "MG"){$checkedMG="selected";}
elsif($infopais eq "MY"){$checkedMY="selected";}
elsif($infopais eq "MW"){$checkedMW="selected";}
elsif($infopais eq "MV"){$checkedMV="selected";}
elsif($infopais eq "ML"){$checkedML="selected";}
elsif($infopais eq "MT"){$checkedMT="selected";}
elsif($infopais eq "MA"){$checkedMA="selected";}
elsif($infopais eq "MQ"){$checkedMQ="selected";}
elsif($infopais eq "MU"){$checkedMU="selected";}
elsif($infopais eq "MR"){$checkedMR="selected";}
elsif($infopais eq "YT"){$checkedYT="selected";}
elsif($infopais eq "MX"){$checkedMX="selected";}
elsif($infopais eq "FM"){$checkedFM="selected";}
elsif($infopais eq "MD"){$checkedMD="selected";}
elsif($infopais eq "MC"){$checkedMC="selected";}
elsif($infopais eq "MN"){$checkedMN="selected";}
elsif($infopais eq "ME"){$checkedME="selected";}
elsif($infopais eq "MS"){$checkedMS="selected";}
elsif($infopais eq "MZ"){$checkedMZ="selected";}
elsif($infopais eq "MM"){$checkedMM="selected";}
elsif($infopais eq "NA"){$checkedNA="selected";}
elsif($infopais eq "NR"){$checkedNR="selected";}
elsif($infopais eq "NP"){$checkedNP="selected";}
elsif($infopais eq "NI"){$checkedNI="selected";}
elsif($infopais eq "NE"){$checkedNE="selected";}
elsif($infopais eq "NG"){$checkedNG="selected";}
elsif($infopais eq "NU"){$checkedNU="selected";}
elsif($infopais eq "NO"){$checkedNO="selected";}
elsif($infopais eq "NC"){$checkedNC="selected";}
elsif($infopais eq "NZ"){$checkedNZ="selected";}
elsif($infopais eq "OM"){$checkedOM="selected";}
elsif($infopais eq "NL"){$checkedNL="selected";}
elsif($infopais eq "PK"){$checkedPK="selected";}
elsif($infopais eq "PW"){$checkedPW="selected";}
elsif($infopais eq "PA"){$checkedPA="selected";}
elsif($infopais eq "PG"){$checkedPG="selected";}
elsif($infopais eq "PY"){$checkedPY="selected";}
elsif($infopais eq "PE"){$checkedPE="selected";}
elsif($infopais eq "PF"){$checkedPF="selected";}
elsif($infopais eq "PL"){$checkedPL="selected";}
elsif($infopais eq "PT"){$checkedPT="selected";}
elsif($infopais eq "PR"){$checkedPR="selected";}
elsif($infopais eq "QA"){$checkedQA="selected";}
elsif($infopais eq "GB"){$checkedGB="selected";}
elsif($infopais eq "CF"){$checkedCF="selected";}
elsif($infopais eq "CZ"){$checkedCZ="selected";}
elsif($infopais eq "DO"){$checkedDO="selected";}
elsif($infopais eq "RE"){$checkedRE="selected";}
elsif($infopais eq "RW"){$checkedRW="selected";}
elsif($infopais eq "RO"){$checkedRO="selected";}
elsif($infopais eq "RU"){$checkedRU="selected";}
elsif($infopais eq "EH"){$checkedEH="selected";}
elsif($infopais eq "WS"){$checkedWS="selected";}
elsif($infopais eq "AS"){$checkedAS="selected";}
elsif($infopais eq "KN"){$checkedKN="selected";}
elsif($infopais eq "SM"){$checkedSM="selected";}
elsif($infopais eq "PM"){$checkedPM="selected";}
elsif($infopais eq "SH"){$checkedSH="selected";}
elsif($infopais eq "LC"){$checkedLC="selected";}
elsif($infopais eq "ST"){$checkedST="selected";}
elsif($infopais eq "SN"){$checkedSN="selected";}
elsif($infopais eq "RS"){$checkedRS="selected";}
elsif($infopais eq "CS"){$checkedCS="selected";}
elsif($infopais eq "SC"){$checkedSC="selected";}
elsif($infopais eq "SL"){$checkedSL="selected";}
elsif($infopais eq "SG"){$checkedSG="selected";}
elsif($infopais eq "SY"){$checkedSY="selected";}
elsif($infopais eq "SO"){$checkedSO="selected";}
elsif($infopais eq "LK"){$checkedLK="selected";}
elsif($infopais eq "SZ"){$checkedSZ="selected";}
elsif($infopais eq "ZA"){$checkedZA="selected";}
elsif($infopais eq "SD"){$checkedSD="selected";}
elsif($infopais eq "SE"){$checkedSE="selected";}
elsif($infopais eq "CH"){$checkedCH="selected";}
elsif($infopais eq "SR"){$checkedSR="selected";}
elsif($infopais eq "TH"){$checkedTH="selected";}
elsif($infopais eq "TW"){$checkedTW="selected";}
elsif($infopais eq "TZ"){$checkedTZ="selected";}
elsif($infopais eq "TJ"){$checkedTJ="selected";}
elsif($infopais eq "TL"){$checkedTL="selected";}
elsif($infopais eq "TG"){$checkedTG="selected";}
elsif($infopais eq "TK"){$checkedTK="selected";}
elsif($infopais eq "TO"){$checkedTO="selected";}
elsif($infopais eq "TT"){$checkedTT="selected";}
elsif($infopais eq "TN"){$checkedTN="selected";}
elsif($infopais eq "TM"){$checkedTM="selected";}
elsif($infopais eq "TR"){$checkedTR="selected";}
elsif($infopais eq "TV"){$checkedTV="selected";}
elsif($infopais eq "UA"){$checkedUA="selected";}
elsif($infopais eq "UG"){$checkedUG="selected";}
elsif($infopais eq "UY"){$checkedUY="selected";}
elsif($infopais eq "UZ"){$checkedUZ="selected";}
elsif($infopais eq "VU"){$checkedVU="selected";}
elsif($infopais eq "VE"){$checkedVE="selected";}
elsif($infopais eq "VN"){$checkedVN="selected";}
elsif($infopais eq "WF"){$checkedWF="selected";}
elsif($infopais eq "YE"){$checkedYE="selected";}
elsif($infopais eq "DJ"){$checkedDJ="selected";}
elsif($infopais eq "ZM"){$checkedZM="selected";}
elsif($infopais eq "ZW"){$checkedZW="selected";}



$valorguia=`/bin/cat $sinoguia`;
$valorguia =~ s/(\r?\n)//g;




$numservicios=0;

	open(OLD, "< $modulos")    or die "can't open $modulos: $!";
		while (<OLD>) 
		{
			if (/^\s*IMT.*=[13].*$/)
     		{
				$numservicios=$numservicios+1;
				
			}
		}	
		 
	close(OLD)     or die "can't close $modulos: $!";



$usoproceso=`top -bn2 | grep "Cpu(s)" | tail -n 1 | awk '{print \$2}' | sed  s/\\%.*//;`; 
$usoprocesoint=int($usoproceso);

$cargaini=$carga;
$cargaini =~ s/load\saverage/$imtlayers_cargasistema/;

#Comienzo HTML
if($CONTENTHTML ne 1)
{
print "Content-type: text/html; charset=$idicharset\n";
print "Content-Language: $idicorto\r\n\r\n";
}
print <<EOF;
<html>

<head>
<meta http-equiv="Cache-Control" content="no-cache">
<link href="/images/${vistaestilo}.css" rel="stylesheet" type="text/css">


<SCRIPT language=javascript>
/*
var ticked = 0;													//global variable, used to keep track of time
var okayToGo = true;											//global variable; if false, locks the animation function call down as long as an animation is in progress
var forwardBackward = 1;										//global variable, determines whether animation cycles normally (1) or in reverse (-1)
var currentCreature = 8;
var theNewContainer = 1;
var theOldContainer = 2;

function toggleContainers()
{
  theNewContainer = (theNewContainer == 1) ? 2 : 1;
  theOldContainer = (theOldContainer == 1) ? 2 : 1;
}

function containerSwitch(theNewCreature)
{
  toggleContainers();
  if(isIE_PNG) headerPNG = '<img src="/shared/wow-com/images/layout/pixel.gif" style="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src=images/bestiary/title-'+theNewCreature.creatureName+'.png);">';
  else headerPNG = "<img src=images/bestiary/title-"+theNewCreature.creatureName+".png>";
  document.getElementById("headerContainer_"+theNewContainer).innerHTML = headerPNG;
  document.getElementById("thumbContainer_"+theNewContainer).style.height = theNewCreature.thumbHeight+"px";
  document.getElementById("thumbContained_"+theNewContainer).innerHTML = "<a href=javascript:bestiaryPopUp('"+theNewCreature.creatureName+"',"+theNewCreature.imgWidth+")><img src='images/bestiary/thumb-"+theNewCreature.creatureName+".jpg' border='0'></a>";
  document.getElementById("loreContainer_"+theNewContainer).innerHTML = theNewCreature.lore;
}

function bestiaryPopUp(namedCreature,imageWidth) 
{
	//Browser detection - is the user relying on the one browser where this script does not work?
	var is_safari = ((navigator.appName.indexOf('safari')!=-1)&&(navigator.appName.indexOf('mac')!=-1))?true:false;
	var screenshot = "images/bestiary/"+namedCreature+".jpg"; //gimp variable for Safari =P

	var name = "Sheenscrot";
	var imgDimensions = (imageWidth == 800) ? [800,600] : [600,800];
	widthHeight = "width=" + imgDimensions[0] + ",height=" + imgDimensions[1];
	winFeatures = "width=" + imgDimensions[0] + ",height=" + imgDimensions[1] + ",left=50,top=50,menubar=no,resizable=no,scrollbars=no,statusbar=no,toolbar=no,locationbar=no"
	if (is_safari) spawn = window.open(screenshot,name,winFeatures);
	else
	{
		spawn = window.open("/shared/wow-com/images/layout/pixel.gif",name,winFeatures)
		spawn.document.write("<html><head><title><\/title><\/head><body onBlur='self.close()' style='background-image:url(images/bestiary/"+namedCreature+".jpg); background-repeat:no-repeat;'><\/body><\/html>"); 
		spawn.document.close();
	}
}

//Martin's quick and dirty (also slick and purdy) PNG fix for IE
var isIE_PNG = (navigator.appName == "Microsoft Internet Explorer" && navigator.userAgent.indexOf('Opera') == -1);
function pngImage(imgSource)
{
  if(isIE_PNG) document.write('<img src="/shared/wow-com/images/layout/pixel.gif" style="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='+imgSource+');">');
  else document.write("<img src="+imgSource+">");
}

function itemSlideShow(prevOrNext)								//called if the user clicks "Previous" or "Next"; has 1 (next) or -1 (previous) as a parameter
{
  if (okayToGo)													//if the function is not locked
  {
    newCreature = currentCreature + prevOrNext;							//used later to determine the next Div ID in the monsterNames array
    if (newCreature >= aBestiary.length) newCreature = 0;			//overflow catch; if the new identifier is larger than the number of elements in the array 
    else if (newCreature < 0) newCreature = aBestiary.length -1;		//or less than zero, jump to zero (the former) or to the last element in the array (the latter)
    forwardBackward = prevOrNext;								//grabs the function parameter, sets the scroll direction accordingly
    moveItem(newCreature);											//calls the Animation Control Function, passing the new item identifier as a parameter
  }
}

function moveItem(thisCreature)										//Animation Control Function
{
  if(okayToGo && thisCreature != currentCreature)						//if the function is not locked and the user clicked on a new item (not the current one)
  {
    containerSwitch(aBestiary[thisCreature]);
	newCreature = thisCreature;											//grabs the parameter, stores it for later use
	document.getElementById("mainContainer_"+theNewContainer).style.zIndex = 50+10*forwardBackward;		//tricky; if forward, new item slides in behind the current item
	document.getElementById("mainContainer_"+theOldContainer).style.zIndex = 50+20*forwardBackward;	    //if backward, new item slides in in front of the current item
	startTheMove = window.setInterval("rightOrLeft()",20);		//calls the Animation Execution Function
  }
}

function rightOrLeft()											//Animation Execution Function
{
  if (ticked == 1020)											//after one second has passed, i.e. one cycle is finished
  {
    window.clearInterval(startTheMove);							//stop the animation
	ticked = 0;													//reset the timer
	forwardBackward = 1;										//reset the scroll direction
	currentCreature = newCreature;								//make the new item the current item
    okayToGo = true;											//unlock the Animation Control Function
  }
  else
  {
    okayToGo = false;											//lock the Animation Control Function
	thisAngle = (Math.PI/2)*(ticked/1000);						//percentual angle, measured in radians; goes from 0 to 1.5708 (or 90 degrees)
	document.getElementById("mainContainer_"+theNewContainer).style.left = " "+(535-Math.sin(thisAngle)*700)+"px"; //sets the X coordinate, following a sine curve
	document.getElementById("mainContainer_"+theNewContainer).style.top = " "+(105-(forwardBackward*Math.cos(thisAngle)*55))+"px"; //sets the Y coordinate, following a cosine curve
	document.getElementById("mainContainer_"+theOldContainer).style.left = " "+(535-Math.sin(thisAngle+Math.PI/2)*700)+"px"; //la la la, math is fun
	document.getElementById("mainContainer_"+theOldContainer).style.top = " "+(105-(forwardBackward*Math.cos(thisAngle+Math.PI/2)*55))+"px"; //oooh, look, numbers! =)
	ticked += 20;												//increase the timekeeper
  }
}


function bestiaryCreature(creatureName,thumbHeight,imgWidth,lore)
{
  this.creatureName = creatureName;
  this.thumbHeight = thumbHeight;
  this.imgWidth = imgWidth;
  this.lore = lore;
}

function creatureSort(creatureA, creatureB)
{
  sortedCreatures = new Array(creatureA.creatureName,creatureB.creatureName);
  sortedCreatures.sort();
  if (sortedCreatures[0] == creatureA.creatureName) return -1;
  else return 1;
}

aBestiary = new Array(); i=0;

cBroken = new bestiaryCreature("broken",100,600);
cBroken.lore = "The orcs of Outland were not the only ones to suffer the Burning Legion's demonic corruption. The Broken, led by the great Akama, fell prey to the demons' sinister influence, and just like the orcs, they too were changed by the corruption. Though they lost some of their former powers, the Broken still present a clear danger to all of Illidan's enemies throughout Outland. It almost seems like a miracle that the Broken somehow managed to preserve their shamanistic heritage, yet no one can say for sure how many of their traditions are still intact. From the safety of the fortified villages the Broken hold in Outland, they lord over their lesser cousins, the wretched Lost Ones.";
aBestiary[i] = cBroken; i++;
cEthereal = new bestiaryCreature("ethereal",90,600);
cEthereal.lore = "Treading the chaotic spaces between worlds, the ethereals are astral travelers who dwell within the Twisting Nether. They are known to be collectors and traders of arcane items and artifacts. Now drawn to Outland, many ethereals are seeking to track down its treasures and steal them back into the Twisting Nether. They are liars and scoundrels who will stop at nothing to pursue their mysterious aims. The ethereals have no care at all for the Burning Crusade. They would even play both sides of the conflict against each other if doing so would serve to further their own goals.";
aBestiary[i] = cEthereal; i++;


*/
</SCRIPT>


<script language="javascript">


function enviar()
{
oscuprocessform();

document.theform.env.value="nombreid"
document.theform.action='iniciov3.htm';
document.theform.submit();
}

function send()
{
oscuprocessform();

	document.theform.action="iniciov3.htm";
	document.theform.env.value="aplicarinfo"
	document.theform.submit();
}


function controlamulti()
{			
var nombreid;
nombreid=document.getElementById('nombreid').value;
top.document.title="$index_titulo: "+nombreid;
}

function validarkey(e)
{			
 	tecla = (document.all) ? e.keyCode : e.which; // 2
    if (tecla==8) return true; // 3
    patron =/[A-Za-z0-9-]/; // 4
    te = String.fromCharCode(tecla); // 5
    return patron.test(te); // 6

}


top.document.title="$index_titulo: "+"$nombreid";







// <script>

// Copyright (C) 2005 Ilya S. Lyubinskiy. All rights reserved.
// Technical support: http://www.php-development.ru/
//
// YOU MAY NOT
// (1) Remove or modify this copyright notice.
// (2) Distribute this code, any part or any modified version of it.
//     Instead, you can link to the homepage of this code:
//     http://www.php-development.ru/javascripts/dropdown.php.
//
// YOU MAY
// (1) Use this code on your website.
// (2) Use this code as a part of another product provided that
//     its main use is not creating javascript menus.
//
// NO WARRANTY
// This code is provided "as is" without warranty of any kind, either
// expressed or implied, including, but not limited to, the implied warranties
// of merchantability and fitness for a particular purpose. You expressly
// acknowledge and agree that use of this code is at your own risk.


// ----- Popup Control ---------------------------------------------------------

function at_display(x)
{
  var win = window.open();
  for (var i in x) win.document.write(i+' = '+x[i]+'<br>');
}

// ----- Show Aux -----

function at_show_aux(parent, child)
{
  var p = document.getElementById(parent);
  var c = document.getElementById(child );

  var top  = (c["at_position"] == "y") ? p.offsetHeight+2 : 0;
  var left = (c["at_position"] == "x") ? p.offsetWidth +2 : 0;

  for (; p; p = p.offsetParent)
  {
    top  += p.offsetTop;
    left += p.offsetLeft;
  }

  c.style.position   = "absolute";
  c.style.top        = top +'px';
  c.style.left       = left+'px';
  c.style.visibility = "visible";
}

// ----- Show -----

function at_show()
{
  var p = document.getElementById(this["at_parent"]);
  var c = document.getElementById(this["at_child" ]);

  at_show_aux(p.id, c.id);

  clearTimeout(c["at_timeout"]);
}

// ----- Hide -----

function at_hide()
{
  var c = document.getElementById(this["at_child"]);

  c["at_timeout"] = setTimeout("document.getElementById('"+c.id+"').style.visibility = 'hidden'", 333);
}

// ----- Click -----

function at_click()
{
  var p = document.getElementById(this["at_parent"]);
  var c = document.getElementById(this["at_child" ]);

  if (c.style.visibility != "visible")
       at_show_aux(p.id, c.id);
  else c.style.visibility = "hidden";

  return false;
}

// ----- Attach -----

// PARAMETERS:
// parent   - id of visible html element
// child    - id of invisible html element that will be dropdowned
// showtype - "click" = you should click the parent to show/hide the child
//            "hover" = you should place the mouse over the parent to show
//                      the child
// position - "x" = the child is displayed to the right of the parent
//            "y" = the child is displayed below the parent
// cursor   - Omit to use default cursor or check any CSS manual for possible
//            values of this field

function at_attach(parent, child, showtype, position, cursor)
{
  var p = document.getElementById(parent);
  var c = document.getElementById(child);

  p["at_parent"]     = p.id;
  c["at_parent"]     = p.id;
  p["at_child"]      = c.id;
  c["at_child"]      = c.id;
  p["at_position"]   = position;
  c["at_position"]   = position;

  c.style.position   = "absolute";
  c.style.visibility = "hidden";

  if (cursor != undefined) p.style.cursor = cursor;

  switch (showtype)
  {
    case "click":
      p.onclick     = at_click;
      p.onmouseout  = at_hide;
      c.onmouseover = at_show;
      c.onmouseout  = at_hide;
      break;
    case "hover":
      p.onmouseover = at_show;
      p.onmouseout  = at_hide;
      c.onmouseover = at_show;
      c.onmouseout  = at_hide;
      break;
  }
}



 // gvid,s,d,pro,port,comm,tainted
ruledata = new Array();

 
var speed=30; 
var loop, timer; 
var openedCombo=null;


function findPosX(obj)
{
	var curleft = 0;
	if (obj.offsetParent)
	{
		while (obj.offsetParent)
		{
			curleft += obj.offsetLeft
			obj = obj.offsetParent;
		}
	}
	else if (obj.x)
		curleft += obj.x;
	return curleft;
}

function findPosY(obj)
{
	var curtop = 0;
	if (obj.offsetParent)
	{
		while (obj.offsetParent)
		{
			curtop += obj.offsetTop
			obj = obj.offsetParent;
		}
	}
	else if (obj.y)
		curtop += obj.y;
	return curtop;
}


function findIndex(value)
{
	var k = 0;
	for(k=0;k < this.data.length;k++)
	{
		if(this.data[k][2] == value)
			return k;
	}
	return -1;
}


function ConstructObject1(nombre,valores)
{  

    	this.el=document.getElementById(nombre); 
		
    	this.cnt=document.getElementById(nombre+'cnt'); 
    	//this.data=getValores(valores);
    	this.up=MoveAreaUp;
    	this.down=MoveAreaDown; 
    	this.MoveArea=MoveArea; 
    	this.x=0; 
    	this.y=0; 
    	this.initialised=false;
    	
	this.cnt.style.cssText="position:relative;top:0; left:0;visibility:inherited";

//this.el.style.cssText="position:absolute; width:150;height:"+this.cnt.offsetHeight
//+"; overflow:hidden; top:0; left:0; clip:rect(0,150,"+this.cnt.offsetHeight
//+",0); visibility:visible";

	this.el.style.cssText="position:absolute; width:550; height:600; overflow:hidden; top:0; left:0; clip:rect(0,550,600,0); visibility:visible";

    	this.obj = nombre + "Object" 
    	eval(this.obj + "=this") 
    	this.selectedIndex=0;
    	//this.drawData=drawData;
    	//this.drawData(this.data);
    	this.findIndex=findIndex;
    	this.scrollHeight=this.cnt.offsetHeight;
    	this.clipHeight=this.el.offsetHeight; 
    	
    	
//    	alert(this.data.toString());
    	return this 
} 

function ConstructObject2(nombre,valores)
{ 
    	this.el=document.getElementById(nombre); 
    	this.cnt=document.getElementById(nombre+'cnt'); 
    	//this.data=getValores(valores);
    	this.up=MoveAreaUp;
    	this.down=MoveAreaDown; 
    	this.MoveArea=MoveArea; 
    	this.x=0; 
    	this.y=0; 
    	this.initialised=false;
    	
		
	this.cnt.style.cssText="position:relative;top:0; left:0;visibility:inherited";

//this.el.style.cssText="position:absolute; width:150;height:"+this.cnt.offsetHeight
//+"; overflow:hidden; top:0; left:0; clip:rect(0,150,"+this.cnt.offsetHeight
//+",0); visibility:visible";

	this.el.style.cssText="position:absolute; width:460; height:600; overflow:hidden; top:0; left:0; clip:rect(0,460,600,0); visibility:visible";
 
    	this.obj = nombre + "Object" 
    	eval(this.obj + "=this") 
    	this.selectedIndex=0;
    	//this.drawData=drawData;
    	//this.drawData(this.data);
    	this.findIndex=findIndex;
    	this.scrollHeight=this.cnt.offsetHeight;
    	this.clipHeight=this.el.offsetHeight; 
    	
    	
//    	alert(this.data.toString());
    	return this 
} 



function ConstructObject3(nombre,valores)
{ 
    	this.el=document.getElementById(nombre); 
    	this.cnt=document.getElementById(nombre+'cnt'); 
    	//this.data=getValores(valores);
    	this.up=MoveAreaUp;
    	this.down=MoveAreaDown; 
    	this.MoveArea=MoveArea; 
    	this.x=0; 
    	this.y=0; 
    	this.initialised=false;
    	
		
	this.cnt.style.cssText="position:relative;top:0; left:0;visibility:inherited";

//this.el.style.cssText="position:absolute; width:150;height:"+this.cnt.offsetHeight
//+"; overflow:hidden; top:0; left:0; clip:rect(0,150,"+this.cnt.offsetHeight
//+",0); visibility:visible";

	this.el.style.cssText="position:absolute; width:410; height:600; overflow:hidden; top:0; left:0; clip:rect(0,410,600,0); visibility:visible";
 
    	this.obj = nombre + "Object" 
    	eval(this.obj + "=this") 
    	this.selectedIndex=0;
    	//this.drawData=drawData;
    	//this.drawData(this.data);
    	this.findIndex=findIndex;
    	this.scrollHeight=this.cnt.offsetHeight;
    	this.clipHeight=this.el.offsetHeight; 
    	
    	
//    	alert(this.data.toString());
    	return this 
} 




var initialised; 

function MoveArea(x,y){ 
    this.x=x;
    this.y=y 
    this.cnt.style.left=this.x 
    this.cnt.style.top=this.y 
} 
 
function MoveAreaDown(move)
{ 
	if(this.y<0)
	{ 
    		this.MoveArea(0,this.y+move) 
    		if(loop) 
    			setTimeout(this.obj+".down("+move+")",speed) 
	} 
} 

function MoveAreaUp(move){ 
//alert(this.clipHeight+"..."+this.y+"..."+this.scrollHeight );
    if(( this.clipHeight - this.y  ) < this.scrollHeight)
    { 
    		this.MoveArea(0,this.y+move) 
    		if(loop) 
    			setTimeout(this.obj+".up("+move+")",speed) 
	} 
} 

function PerformScroll(objeto,speed){ 
 if(objeto.initialised){ 
  loop=true; 
  if(speed>0) 
   objeto.down(speed) 
  else 
   objeto.up(speed) 
 } 
} 
 
function CeaseScroll(objeto){ 
//alert(ruledata.toString());
    loop=false 
    if(timer) clearTimeout(timer) 
}


function InitialiseScrollableArea1(name,data)
{ 
    var obj=new ConstructObject1(name,data); 
    obj.MoveArea(0,0); 
    obj.el.style.visibility='hidden';
    obj.initialised=true; 
    return obj;
} 

function InitialiseScrollableArea2(name,data)
{ 
    var obj=new ConstructObject2(name,data); 
    obj.MoveArea(0,0); 
    obj.el.style.visibility='hidden';
    obj.initialised=true; 
    return obj;
} 

function InitialiseScrollableArea3(name,data)
{ 
    var obj=new ConstructObject3(name,data); 
    obj.MoveArea(0,0); 
    obj.el.style.visibility='hidden';
    obj.initialised=true; 
    return obj;
} 


function capagrande()
{


	container='objContainer1';

	var objContainer = eval(container); 
	objContainer.el.style.left=255;
	objContainer.el.style.top=130;
	
	if(openedCombo!=null)
				eval(openedCombo).el.style.visibility='hidden';
				

	if(objContainer.el.style.visibility=='visible') //esconder
	{
		objContainer.el.style.visibility='hidden';
		openedCombo=null;
	}
	else//mostrar
	{
		openedCombo=container;
		objContainer.el.style.visibility='visible'; 
	}	 

}


function clearLista()
{
	if(openedCombo!=null)
		eval(openedCombo).el.style.visibility='hidden';
	
	openedCombo=null;
}



function InitialiseAreas()
{ 
	//alert(ruledata.toString());
EOF
if($valorguia eq 1)
{
print <<EOF;
	objContainer1=InitialiseScrollableArea1('divContainer1',null);
	
EOF
}
print <<EOF;
objContainer2=InitialiseScrollableArea2('divContainer2',null);
objContainer3=InitialiseScrollableArea3('divContainer3',null);
	//initRules();
} 


function quitarguia()
{
oscuprocessform();

	document.theform.env.value="quitarguia"
	document.theform.action='iniciov3.htm';
	document.theform.submit();	
}

function borrarpasoreg(opc)
{

if(!confirm('┐Desea borrar el registro de accesos vьa '+opc+' a I.M.T.?'))
	return false;
	
	oscuprocessform();
	
	document.theform.env.value=opc+"reg";
	document.theform.action='iniciov3.htm';
	document.theform.submit();	
}


function toggle()
{

	container='objContainer2';
	
	var objContainer = eval(container); 
	objContainer.el.style.left=265;
	objContainer.el.style.top=140;
	
	if(openedCombo!=null)
				eval(openedCombo).el.style.visibility='hidden';
				
	if(objContainer.el.style.visibility=='visible') //esconder
	{
		objContainer.el.style.visibility='hidden';
		curListener=null;
		openedCombo=null;
	}
	else//mostrar
	{
		openedCombo=container;
		objContainer.el.style.visibility='visible'; 
	}	
		
}

function toggle3()
{

	container='objContainer3';
	
	var objContainer = eval(container); 
	objContainer.el.style.left=265;
	objContainer.el.style.top=140;
	
	if(openedCombo!=null)
				eval(openedCombo).el.style.visibility='hidden';
				
	if(objContainer.el.style.visibility=='visible') //esconder
	{
		objContainer.el.style.visibility='hidden';
		curListener=null;
		openedCombo=null;
	}
	else//mostrar
	{
		openedCombo=container;
		objContainer.el.style.visibility='visible'; 
	}	
		
}


</script>


<style>
<!--

/* Context menu Script- Е Dynamic Drive (www.dynamicdrive.com) Last updated: 01/08/22
For full source code and Terms Of Use, visit http://www.dynamicdrive.com */

.skin0{
position:absolute;
width:165px;
border:2px solid orange;
background-color:menu;
font-family:Verdana;
line-height:20px;
cursor:default;
font-size:10px;
z-index:100;
visibility:hidden;
filter:alpha(opacity=85);-moz-opacity:.85;opacity:.85;
}

.menuitems{
padding-left:10px;
padding-right:10px;
}
-->
</style>



<!--	<script src="/images/jquery-1.4.min.js"></script>


	<script src="/images/jquery.speedometer.js"></script>
	<script src="/images/jquery.jqcanvas-modified.js"></script>
	<script src="/images/excanvas-modified.js"></script>
-->

EOF


print $q->start_html(-title=>'The Riddle of the Sphinx',
                 -script=>[
                           { -type => 'text/javascript',
                             -src      => '/images/jquery-1.4.min.js'
                           },
                           { -type => 'text/javascript',
                             -src      => '/images/jquery.speedometer.js'
                           },
                           { -type => 'text/jscript',
                             -src      => '/images/jquery.jqcanvas-modified.js'
                           },
                           { -type => 'text/ecmascript',
                             -src      => '/images/excanvas-modified.js'
                           }
                        ]
                    );

print <<EOF;

	<script>

		\$(function(){
			\$('#test').speedometer();

			\$('.changeSpeedometer').click(function(){
				\$('#test').speedometer({ percentage: \$('.speedometer').val() || 0 });
			});

		});


		\$(function(){
			\$('#test2').speedometer();

			\$('.changeSpeedometer').click(function(){
				\$('#test2').speedometer({ percentage: \$('.speedometer').val() || 0 });
			});

		});

		
	</script>	



</head>


EOF
if($valorguia eq 1)
{
$cargaonload="onLoad=capagrande()";
}
print <<EOF;
	
<body ${cargaonload} onclick="clearLista()">

<form name="theform" method="post" onsubmit="oscuprocessform()">
<input name="env" type="hidden">

<CENTER><!--<table cellpadding=0 cellspacing=0><tr>
<td width="70" align="center" valign="bottom"><A HREF=notas.htm target=main><img src='../images/note.gif' border="0"></a><br><b>&nbsp;$numnotas $inicio_notas</b></td>
<td width="75" align="center" valign="bottom"><A HREF=monit.htm target=main><img src='../images/alertasestado.gif' border="0"></a><br><b>&nbsp;0 $inicio_alertas</b></td>
<td width="80" align="center" valign="bottom"><A HREF=incidencias.htm target=main><img src='../images/incidencia.gif' border="0"></a><br><b>&nbsp;0 $inicio_incidencias</b></td>
<td width="100"></td><td><img src='../images/casa.gif'></td><td width="10"></td><td><FONT SIZE=+1 COLOR=#3e73a8 class="color"><B>$inicio_titulo0</B></FONT></td><td width="30"></td></td><td width="90"></td>
<td width="100" align="center" valign="bottom"><img src='../images/wizard.gif' border="0" style="cursor:pointer" onClick="myRef = window.open('wizard.htm','mywin','left=330,top=150,width=630,height=420,toolbar=1,resizable=0,status=0,menubar=0');myRef.focus()"><br><b>&nbsp;$inicio_ppasos</b></td>
<td width="15"></td>
<td align="center" valign="bottom">
<img src='../images/consola.gif' style="cursor:pointer" onClick="myRef = window.open('consola.htm','mywin','left=330,top=150,width=550,height=400,toolbar=1,resizable=0,status=0,menubar=0');myRef.focus()">
<br><b>$inicio_consolaimt </b></td></tr></table>-->
<br>
<table cellpadding=0 cellspacing=0><tr><!--<td><img src='../images/consolaminilinux.gif'></td><td width="10"></td>--><td><FONT SIZE=+1 style="font-weight: bold;color:#3e73a8"><B>Web shell Linux</B></FONT></td></tr></table>


<!--<HR  style="color: #3e73a8;background: #3e73a8">	 -->


<script language="JavaScript1.2">

function oscuprocessform()
{
document.getElementById('oscuprocess').style.visibility='visible';
document.getElementById('oscuprocess2').style.visibility='visible';           
}

/*if (navigator.appVersion.indexOf("MSIE")!=-1){
	document.write("<HR NOSHADE class='barracolor'>");
}
else
{
	document.write("<div width='100%' style='background-color: #3e73a8; height:2px; max-height:2px;-webkit-box-shadow: 0px 0px 6px 0px #3e73a8;
  -moz-box-shadow: 0px 0px 6px 0px #3e73a8;
  box-shadow: 0px 0px 6px 0px #3e73a8;
  -webkit-border-radius: 15;
  -moz-border-radius: 15;
  border-radius: 15px;'></div>");
}*/

</script>

<br><br><br><br>
<!--
<div id="ie5menu" class="skin0" onMouseover="highlightie5(event)" onMouseout="lowlightie5(event)" onClick="jumptoie5(event)" display:none>

<div class="menuitems" url="http://www.infodesain.com">www.infodesain.com</div>
<div class="menuitems" url="#" target="newwin">Tablзn de notas</div>
<div class="menuitems" url="#">Incidencias</div>
<div class="menuitems" url="#"></div>
<div class="menuitems" url="#">FAQs</div>
<div class="menuitems" url="#">Buscador</div>
<hr class="barracolor">
<table><tr><td><img src="../images/carafeliz.gif"></td><td><div class="menuitems" url="#">MenЩ Personal</div></td></tr></table>
</div>

<script language="JavaScript1.2">

//set this variable to 1 if you wish the URLs of the highlighted menu to be displayed in the status bar
var display_url=0

var ie5=document.all&&document.getElementById
var ns6=document.getElementById&&!document.all
if (ie5||ns6)
var menuobj=document.getElementById("ie5menu")

function showmenuie5(e){
//Find out how close the mouse is to the corner of the window
var rightedge=ie5? document.body.clientWidth-event.clientX : window.innerWidth-e.clientX
var bottomedge=ie5? document.body.clientHeight-event.clientY : window.innerHeight-e.clientY

//if the horizontal distance isn't enough to accomodate the width of the context menu
if (rightedge<menuobj.offsetWidth)
//move the horizontal position of the menu to the left by it's width
menuobj.style.left=ie5? document.body.scrollLeft+event.clientX-menuobj.offsetWidth : window.pageXOffset+e.clientX-menuobj.offsetWidth
else
//position the horizontal position of the menu where the mouse was clicked
menuobj.style.left=ie5? document.body.scrollLeft+event.clientX : window.pageXOffset+e.clientX

//same concept with the vertical position
if (bottomedge<menuobj.offsetHeight)
menuobj.style.top=ie5? document.body.scrollTop+event.clientY-menuobj.offsetHeight : window.pageYOffset+e.clientY-menuobj.offsetHeight
else
menuobj.style.top=ie5? document.body.scrollTop+event.clientY : window.pageYOffset+e.clientY

menuobj.style.visibility="visible"
return false
}

function hidemenuie5(e){
menuobj.style.visibility="hidden"
}

function highlightie5(e){
var firingobj=ie5? event.srcElement : e.target
if (firingobj.className=="menuitems"||ns6&&firingobj.parentNode.className=="menuitems"){
if (ns6&&firingobj.parentNode.className=="menuitems") firingobj=firingobj.parentNode //up one node
firingobj.style.backgroundColor="#3e73a8"
firingobj.style.color="white"
if (display_url==1)
window.status=event.srcElement.url
}
}

function lowlightie5(e){
var firingobj=ie5? event.srcElement : e.target
if (firingobj.className=="menuitems"||ns6&&firingobj.parentNode.className=="menuitems"){
if (ns6&&firingobj.parentNode.className=="menuitems") firingobj=firingobj.parentNode //up one node
firingobj.style.backgroundColor=""
firingobj.style.color="black"
window.status=''
}
}

function jumptoie5(e){
var firingobj=ie5? event.srcElement : e.target
if (firingobj.className=="menuitems"||ns6&&firingobj.parentNode.className=="menuitems"){
if (ns6&&firingobj.parentNode.className=="menuitems") firingobj=firingobj.parentNode
if (firingobj.getAttribute("target"))
window.open(firingobj.getAttribute("url"),firingobj.getAttribute("target"))
else
window.location=firingobj.getAttribute("url")
}
}

if (ie5||ns6){
menuobj.style.display=''
document.oncontextmenu=showmenuie5
document.onclick=hidemenuie5
}

</script>
-->
<script>
//if (!document.layers)
//document.write('<div id="divStayTopLeft" style="position:absolute" class="opaco2">')
</script>


<!--
<layer id="divStayTopLeft">

<table cellspacing="0" cellpadding="0">

<tr><td>
<table width="70" cellspacing="0" height="20"><tr><td background="../images/barratitulo3.gif" align="center">
<font color="white"><b>и Accesos и</b></font>
</td></tr></table>
</td></tr>

<tr><td height="8"></td></tr>

  <tr>
    <td width="100%" title="Rastreador Netbios" align="center">
	<img src="../images/rastreo.gif" style="cursor:pointer">
	</td>
  </tr>
  <tr><td height="8"></td></tr>
   <tr>
    <td width="100%" title="Groupware" align="center">
	<img src="../images/groupware.gif" style="cursor:pointer">
	</td>
  </tr>
  <tr><td height="8"></td></tr>
   <tr>
    <td width="100%" title="Portal Cautivo" align="center">
	<img src="../images/wifi.gif" style="cursor:pointer">
	</td>
  </tr>
  <tr><td height="8"></td></tr>
   <tr>
    <td width="100%" title="Servidor de mensajerьa interno" align="center">
	<img src="../images/jabber.gif" style="cursor:pointer">
	</td>
  </tr>
  <tr><td height="8"></td></tr>
</table>

</layer>
-->

<script type="text/javascript">

/*
var verticalpos="frombottom"

if (!document.layers)
document.write('</div>')

function JSFX_FloatTopDiv()
{
	var startX = 15,
	startY = 450;
	var ns = (navigator.appName.indexOf("Netscape") != -1);
	var d = document;
	function ml(id)
	{
		var el=d.getElementById?d.getElementById(id):d.all?d.all[id]:d.layers[id];
		if(d.layers)el.style=el;
		el.sP=function(x,y){this.style.right=x;this.style.top=y;};
		el.x = startX;
		if (verticalpos=="fromtop")
		el.y = startY;
		else{
		el.y = ns ? pageYOffset + innerHeight : document.body.scrollTop + document.body.clientHeight;
		el.y -= startY;
		}
		return el;
	}
	window.stayTopLeft=function()
	{
		if (verticalpos=="fromtop"){
		var pY = ns ? pageYOffset : document.body.scrollTop;
		ftlObj.y += (pY + startY - ftlObj.y)/8;
		}
		else{
		var pY = ns ? pageYOffset + innerHeight : document.body.scrollTop + document.body.clientHeight;
		ftlObj.y += (pY - startY - ftlObj.y)/8;
		}
		ftlObj.sP(ftlObj.x, ftlObj.y);
		setTimeout("stayTopLeft()", 10);
	}
	ftlObj = ml("divStayTopLeft");
	stayTopLeft();
}
JSFX_FloatTopDiv();
*/

</script>

<div style="background:#3e73a8; width:850; height:755;-webkit-box-shadow: 0px 1px 3px black;
  -moz-box-shadow: 0px 1px 3px black;
  box-shadow: 0px 1px 3px black;
  -webkit-border-radius: 20;
  -moz-border-radius: 20;
  border-radius: 20px;">
<table><tr><td height="8"></td></table>
<div style="background:black; width:810; height:730;-webkit-box-shadow: 0px 1px 5px black;
  -moz-box-shadow: 0px 1px 5px black;
  box-shadow: 0px 1px 5px black;
  -webkit-border-radius: 20;
  -moz-border-radius: 20;
  border-radius: 20px;">

<table><tr><td height="3"></td></tr></table>


<br>

<table width="800" cellpadding="0" cellspacing="0" border="0"><tr>
<td align="center" valign="center">

<iframe src="/webshell/"  frameborder="no" scrolling="no" width=100% height=650 name="webshell"></iframe>

<tr><td height="5"></td></tr>
</table>

</div>
</td>
</tr></table>

</div>
</td>
</tr>
</table>
</div>

<script language="javascript">InitialiseAreas(); </script>
<!--
<div style="position:absolute; left:0; top:0; visibility:visible; Z-INDEX: 1000; opacity:0.4; filter:alpha(opacity=40);height: 100%; width:100%;" >
<table cellpadding="0" cellspacing="0" bgcolor=black width="100%" height="100%"><tr><td align=center>
</td></tr>
</table>
</div>

<div style="position:absolute; top:160; visibility:visible; Z-INDEX: 1001; margin-left: auto; margin-right: auto; width: 500px; height: 300px; left: 30%">
<table cellpadding="0" cellspacing="0" bgcolor=white width="100%" height="100%" style="background: url(../images/bg-blue.png)"><tr><td align=center>

<table border=0 width=480><tr><td width=20></td><td align=center>

<font size=4>

<table>
<tr><td><img src="/images/conectadook.gif"></td><td><font size=4>Conexiзn a internet</font><br><div align=right><font color='#3e73a8' size=2><b><u>Configuraciзn lan</u></b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div></td></tr>
<tr><td><img src="/images/conectadook.gif"></td><td><font size=4>Disponible servidor de registro</font><br><div align=right><font color='#3e73a8' size=2><b>48 horas restan para el registro</b></font></div></td></tr>
</table>

<br>

<table bgcolor=white style="BORDER-BOTTOM: #3e73a8 1px solid; BORDER-LEFT: #3e73a8 1px solid; BORDER-TOP: #3e73a8 1px solid; BORDER-RIGHT: #3e73a8 1px solid">
<tr><td height=2></td><tr>
<tr><td width=5></td><td>N┌MERO CLIENTE</td><td width=3></td><td><input type=text size=10 class='campotxt'></td><td width=5></td></tr>

<tr><td width=5></td><td>N┌MERO LICENCIA</td><td width=3></td><td><input type=text size=10 class='campotxt'></td><td width=5></td></tr>

<tr><td width=5></td><td>CМDIGO ACTIVACIМN</td><td width=3></td><td><input type=text size=10 class='campotxt'></td><td width=5></td></tr>
<tr><td height=2></td><tr>
</table>

</font>

<br>

<table border="0" align="center" cellpadding="0" cellspacing="0">
<tr>
<td>
<input type="image" src="../images/submit_out.gif" name="boton1" id="boton1" value="Aplicar" onmousemove="status='Enviar'" onmousedown="this.src='../images/submit_in.gif';"  onmouseover="this.src='../images/submit_over.gif';" onmouseout="status=window.defaultStatus;this.src='../images/submit_out.gif';" target="_self" border="0" onclick="send()">

<input type="image" src="../images/reset_out.gif" value="Cancelar" id="boton2" name="boton2" onmousemove="status='Enviar'" onmousedown="this.src='../images/reset_in.gif';"  onmouseover="this.src='../images/reset_over.gif';" onmouseout="status=window.defaultStatus;this.src='../images/reset_out.gif';" target="_self" onClick="reset()">
</td>
</tr>
</table>

</td>
<td valign=top align=right>
<br>
<img src="/images/registernow.gif">
</td>
</tr></table>

</td></tr>
</table>
</div>
-->


EOF
require "$imtlayers";
print <<EOF;
</form>
</body>
</html>
EOF

#eliminar variable temporal de uso
system("/bin/rm $aux >/dev/null 2>&1");


